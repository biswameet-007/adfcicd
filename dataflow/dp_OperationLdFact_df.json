{
	"name": "dp_OperationLdFact_df",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "AzSnpMXMSTGAsset3",
						"type": "DatasetReference"
					},
					"name": "srcOperationRead"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "OrgSiteRefRd"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "AssetRefRd"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "PersonRefRd"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "JobplanRefRd"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "PerGrpRefRd"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "LocationRefRd"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "MaxKey"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "OpsExistingRows"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "srcWorkOrderReadRef"
				},
				{
					"dataset": {
						"referenceName": "OrgSiteRefRd6",
						"type": "DatasetReference"
					},
					"name": "JobplanNullSiteRd"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "SinkOperationLd2",
						"type": "DatasetReference"
					},
					"name": "sinkOpsInsert"
				},
				{
					"dataset": {
						"referenceName": "SinkOperationLd2",
						"type": "DatasetReference"
					},
					"name": "sinkOperationUpdate"
				}
			],
			"transformations": [
				{
					"name": "srtOperation"
				},
				{
					"name": "dcOps"
				},
				{
					"name": "selOperation"
				},
				{
					"name": "lkpOrgsiteoptn"
				},
				{
					"name": "lkpAssetOptn"
				},
				{
					"name": "lkpPersonOptn"
				},
				{
					"name": "lkpJobplanOptn"
				},
				{
					"name": "lkpPerGrpOptn"
				},
				{
					"name": "lkpLocation"
				},
				{
					"name": "selOpsExistingRows"
				},
				{
					"name": "lkpExistOperation"
				},
				{
					"name": "joinMaxKey"
				},
				{
					"name": "skOperation"
				},
				{
					"name": "dcOperationInsert"
				},
				{
					"name": "alterRowOpsInsert"
				},
				{
					"name": "selectOps"
				},
				{
					"name": "lookupOpsStatusInd"
				},
				{
					"name": "selectOps2"
				},
				{
					"name": "splitOpsForUpdate"
				},
				{
					"name": "selOpsUpdate"
				},
				{
					"name": "dcOpsUpdate"
				},
				{
					"name": "alterRowUpdate"
				},
				{
					"name": "splitJobPlan"
				},
				{
					"name": "unionJobplan"
				},
				{
					"name": "selectNullJPSite"
				},
				{
					"name": "selectJPNotNullSite"
				},
				{
					"name": "lkpJPNullSite"
				}
			],
			"scriptLines": [
				"source(output(",
				"          WONUM as string,",
				"          PARENT as string,",
				"          GOVTWONUM as string,",
				"          ORGID as string,",
				"          SITEID as string,",
				"          LOCATION as string,",
				"          STATUS as string,",
				"          ASSETNUM as string,",
				"          JPNUM as string,",
				"          WO_STATUS_CHANGEDATE as timestamp,",
				"          WORKTYPE as string,",
				"          TASKID as integer,",
				"          ISTASK as integer,",
				"          DESCRIPTION as string,",
				"          PLUSCJPREVNUM as integer,",
				"          WOPRIORITY as integer,",
				"          WO_CHANGEDATE as timestamp,",
				"          STATUSDATE as timestamp,",
				"          WO_STATUS_CHANGEBY as string,",
				"          PMDUEDATE as date,",
				"          TARGSTARTDATE as timestamp,",
				"          TARGCOMPDATE as timestamp,",
				"          REPORTDATE as timestamp,",
				"          ACTLABHRS as decimal(18,9),",
				"          ACTSTART as timestamp,",
				"          ACTFINISH as timestamp,",
				"          ACTINTLABHRS as decimal(18,9),",
				"          ESTDUR as decimal(18,9),",
				"          WOGROUP as string,",
				"          PERSONGROUP as string,",
				"          OWNERGROUP as string,",
				"          PLUSCFREQUENCY as integer,",
				"          PLUSCFREQUNIT as string,",
				"          PMNEXTDUEDATE as date,",
				"          PMNUM as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     inferDriftedColumnTypes: true,",
				"     isolationLevel: 'READ_COMMITTED',",
				"     query: 'SELECT \\nWO.WONUM AS WONUM,WO.PARENT AS PARENT,GOVTWONUM,WO.ORGID,WO.SITEID,LOCATION,WS.STATUS AS STATUS,ASSETNUM,JPNUM, WS.CHANGEDATE AS WO_STATUS_CHANGEDATE,\\nWORKTYPE,TASKID,ISTASK, DESCRIPTION,PLUSCJPREVNUM,WOPRIORITY,WO.CHANGEDATE AS WO_CHANGEDATE,STATUSDATE,WS.CHANGEBY AS WO_STATUS_CHANGEBY, PMDUEDATE,\\nTARGSTARTDATE,TARGCOMPDATE,REPORTDATE,ACTLABHRS,ACTSTART, ACTFINISH,ACTINTLABHRS,ESTDUR,WOGROUP,PERSONGROUP,OWNERGROUP,PLUSCFREQUENCY,PLUSCFREQUNIT,\\nPMNEXTDUEDATE,PMNUM\\nFROM MXMSTG.STG_WORKORDER WO, MXMSTG.STG_WOSTATUS WS\\n WHERE\\n WS.WONUM=WO.WONUM\\n AND WS.ORGID=WO.ORGID\\n AND WS.SITEID=WO.SITEID',",
				"     format: 'query',",
				"     staged: true) ~> srcOperationRead",
				"source(output(",
				"          ORGANIZATION_ID as integer,",
				"          SITE_ID as integer,",
				"          ORGANIZATION_NM as string,",
				"          SITE_NM as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT O.ORGANIZATION_ID,S.SITE_ID,O.ORGANIZATION_NM,S.SITE_NM\\nFROM\\nMXMDW.ORGANIZATION O,\\nMXMDW.SITE S\\nWHERE\\nS.ORGANIZATION_ID=O.ORGANIZATION_ID',",
				"     format: 'query',",
				"     staged: true) ~> OrgSiteRefRd",
				"source(output(",
				"          ASSET_ID as integer,",
				"          ASSETNUM_ref as string,",
				"          SITE_ID_ref as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT ASSET_ID,ASSETNUM AS ASSETNUM_ref,SITE_ID AS SITE_ID_ref FROM MXMDW.ASSET',",
				"     format: 'query',",
				"     staged: true) ~> AssetRefRd",
				"source(output(",
				"          PERSON_ID as integer,",
				"          PERSON_NBR as string,",
				"          SITE_ID as integer,",
				"          ORGANIZATION_ID as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT PERSON_ID,PERSON_NBR,P.SITE_ID AS SITE_ID,S.ORGANIZATION_ID AS ORGANIZATION_ID FROM \\nMXMDW.PERSON P,\\nMXMDW.ORGANIZATION O,\\nMXMDW.SITE S\\nWHERE\\nO.ORGANIZATION_ID =S.ORGANIZATION_ID\\nAND S.SITE_ID=P.SITE_ID',",
				"     format: 'query',",
				"     staged: true) ~> PersonRefRd",
				"source(output(",
				"          JP_ID as integer,",
				"          JP_NUM as string,",
				"          JPRef_SITE_ID as integer,",
				"          JPRef_ORGANIZATION_ID as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT JP_ID,JP_NUM,SITE_ID AS JPRef_SITE_ID,ORGANIZATION_ID AS JPRef_ORGANIZATION_ID FROM MXMDW.JOBPLAN WHERE STATUS=\\'ACTIVE\\' AND SITE_ID>0',",
				"     format: 'query',",
				"     staged: true) ~> JobplanRefRd",
				"source(output(",
				"          PERSON_GROUP_ID as integer,",
				"          PERSON_GRP_CD as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT PERSON_GROUP_ID,PERSON_GRP_CD FROM MXMDW.PERSON_GROUP',",
				"     format: 'query',",
				"     staged: true) ~> PerGrpRefRd",
				"source(output(",
				"          LOCATION_ID as integer,",
				"          DIM_LOCATION as string,",
				"          LOCATION_DESC as string,",
				"          LOC_SITE_NM as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT L.LOCATION_ID AS LOCATION_ID,L.LOCATION AS DIM_LOCATION,L.DESCRIPTION AS LOCATION_DESC, S.SITE_NM AS LOC_SITE_NM\\nFROM MXMDW.LOCATIONS L\\nINNER JOIN MXMDW.SITE S\\nON S.SITE_ID = L.SITE_ID',",
				"     format: 'query',",
				"     staged: true) ~> LocationRefRd",
				"source(output(",
				"          MAXKEY as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT MAXKEY=ISNULL(MAX(OPERATION_ID),0) FROM  MXMDW.OPERATION',",
				"     format: 'query',",
				"     staged: true) ~> MaxKey",
				"source(output(",
				"          OPERATION_ID as integer,",
				"          WONUM as string,",
				"          SITE_ID as integer,",
				"          STATUS as string,",
				"          WO_STATUS_CHANGEDATE as timestamp,",
				"          SNAPSHOT_DATE as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT OPERATION_ID, WONUM,SITE_ID,STATUS,WO_STATUS_CHANGEDATE,SNAPSHOT_DATE FROM MXMDW.OPERATION WHERE CURRENT_RECORD_IND=1',",
				"     format: 'query',",
				"     staged: true,",
				"     partitionBy('hash', 1)) ~> OpsExistingRows",
				"source(output(",
				"          RefWONUM as string,",
				"          RefSITE_ID as integer,",
				"          RefSTATUS as string,",
				"          RefSTATUSDATE as timestamp,",
				"          FLAG as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT WONUM AS RefWONUM,S.SITE_ID AS RefSITE_ID,STATUS AS RefSTATUS,STATUSDATE AS RefSTATUSDATE,\\'1\\' AS FLAG FROM MXMSTG.STG_WORKORDER WO,MXMDW.SITE S\\nWHERE\\nWO.SITEID=S.SITE_NM',",
				"     format: 'query',",
				"     staged: true) ~> srcWorkOrderReadRef",
				"source(output(",
				"          JP_ID as integer,",
				"          JP_NUM as string,",
				"          JPRef_SITE_ID as integer,",
				"          JPRef_ORGANIZATION_ID as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT JP_ID,JP_NUM,SITE_ID AS JPRef_SITE_ID,ORGANIZATION_ID AS JPRef_ORGANIZATION_ID FROM MXMDW.JOBPLAN WHERE STATUS=\\'ACTIVE\\' AND SITE_ID<0',",
				"     format: 'query',",
				"     staged: true) ~> JobplanNullSiteRd",
				"srcOperationRead sort(asc(WONUM, true),",
				"     asc(PARENT, true),",
				"     asc(ORGID, true),",
				"     asc(SITEID, true),",
				"     asc(WO_STATUS_CHANGEDATE, true),",
				"     caseInsensitive: true) ~> srtOperation",
				"lookupOpsStatusInd derive(CAL_PMDUEDT = iifNull(PMDUEDATE, TARGSTARTDATE,REPORTDATE),",
				"          WORKTYPE_CM_PM = case(\r",
				"     (WORKTYPE == 'CM' || WORKTYPE == 'DMO' || WORKTYPE == 'OWO' || WORKTYPE == 'SERV'), 'CM',\r",
				"     (WORKTYPE == 'PM' || WORKTYPE == 'INSP' || WORKTYPE == 'SWM' || WORKTYPE == 'PMO'), 'PM',\r",
				"        (WORKTYPE == 'PJ' || WORKTYPE == 'PWO' ), 'PJ',\r",
				"        'OTHERS'  \r",
				"     ),",
				"          {REPORTMONTH_YEAR } = year(REPORTDATE),",
				"          REPORTDATE_MONTH = month(REPORTDATE),",
				"          REPORTDATE_CM_PM = case(     \r",
				"     (WORKTYPE == 'PM' || WORKTYPE == 'INSP' || WORKTYPE == 'SWM' || WORKTYPE == 'PMO'), iifNull(PMDUEDATE, TARGSTARTDATE,REPORTDATE),       \r",
				"        REPORTDATE  \r",
				"     ),",
				"          CURRENT_RECORD_IND = iifNull(toInteger(FLAG), 0, 1),",
				"          EFFECTIVE_DT = currentTimestamp(),",
				"          SNAPSHOT_DATE = toTimestamp(toString(WO_STATUS_CHANGEDATE, 'yyyy-MM-dd 00:00:00'),'yyyy-MM-dd HH:mm:ss'),",
				"          ASSET_ID = iifNull(ASSET_ID, toInteger(-1), ASSET_ID),",
				"          PERSON_ID = iifNull(PERSON_ID, toInteger(-1), PERSON_ID),",
				"          JP_ID = iifNull(JP_ID, toInteger(-1), JP_ID),",
				"          PERSON_GROUP_ID = iifNull(PERSON_GROUP_ID, toInteger(-1), PERSON_GROUP_ID),",
				"          LOCATION_ID = iifNull(LOCATION_ID, toInteger(-1), LOCATION_ID),",
				"          AVAILABLE_MANHOUR = toInteger(506),",
				"          PARENT_ACTLABHRS = toDecimal(0.0),",
				"          STATUS_FLAG = case(     \r",
				"     (STATUS == 'READY' || STATUS == 'CLOSE' || STATUS == 'CAN' || STATUS == 'COMP'), 2,1        \r",
				"     )) ~> dcOps",
				"joinMaxKey select(mapColumn(",
				"          WONUM,",
				"          PARENT,",
				"          GOVTWONUM,",
				"          LOCATION_ID,",
				"          STATUS,",
				"          WO_STATUS_CHANGEDATE,",
				"          WORKTYPE,",
				"          TASKID,",
				"          ISTASK,",
				"          DESCRIPTION,",
				"          PLUSCREVNUM = PLUSCJPREVNUM,",
				"          WOPRIORITY,",
				"          STATUSDATE,",
				"          WO_STATUS_CHANGEBY,",
				"          PMDUEDATE,",
				"          TARGSTARTDATE,",
				"          TARGCOMPDATE,",
				"          REPORTDATE,",
				"          WO_CHANGEDATE,",
				"          ACTLABHRS,",
				"          ACTSTART,",
				"          ACTFINISH,",
				"          ACTINTLABHRS,",
				"          WOGROUP,",
				"          CAL_PMDUEDT,",
				"          WORKTYPE_CM_PM,",
				"          {REPORTMONTH_YEAR },",
				"          REPORTDATE_MONTH,",
				"          REPORTDATE_CM_PM,",
				"          CURRENT_RECORD_IND,",
				"          EFFECTIVE_DT,",
				"          SNAPSHOT_DATE,",
				"          ORGANIZATION_ID,",
				"          SITE_ID,",
				"          LOCATION_ID,",
				"          ASSET_ID,",
				"          PERSON_ID,",
				"          JP_ID,",
				"          PERSON_GROUP_ID,",
				"          PERSON_GROUP = PERSONGROUP,",
				"          ESTDUR,",
				"          PLUSCFREQUENCY,",
				"          PLUSCFREQUNIT,",
				"          PMNEXTDUEDATE,",
				"          PMNUM,",
				"          AVAILABLE_MANHOUR,",
				"          CURRENT_RECORD_IND,",
				"          PARENT_ACTLABHRS,",
				"          MAXKEY,",
				"          STATUS_FLAG",
				"     ),",
				"     partitionBy('hash', 1),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selOperation",
				"srtOperation, OrgSiteRefRd lookup(ORGID == ORGANIZATION_NM",
				"     && SITEID == SITE_NM,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lkpOrgsiteoptn",
				"lkpLocation, AssetRefRd lookup(ASSETNUM == ASSETNUM_ref",
				"     && SITE_ID == SITE_ID_ref,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'both')~> lkpAssetOptn",
				"lkpAssetOptn, PersonRefRd lookup(WO_STATUS_CHANGEBY == PERSON_NBR",
				"     && OrgSiteRefRd@ORGANIZATION_ID == PersonRefRd@ORGANIZATION_ID",
				"     && OrgSiteRefRd@SITE_ID == PersonRefRd@SITE_ID,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'both')~> lkpPersonOptn",
				"lkpPersonOptn, JobplanRefRd lookup(JPNUM == JP_NUM",
				"     && OrgSiteRefRd@SITE_ID == JPRef_SITE_ID,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lkpJobplanOptn",
				"unionJobplan, PerGrpRefRd lookup(PERSONGROUP == PERSON_GRP_CD,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lkpPerGrpOptn",
				"lkpOrgsiteoptn, LocationRefRd lookup(LOCATION == DIM_LOCATION",
				"     && SITEID == LOC_SITE_NM,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lkpLocation",
				"OpsExistingRows select(mapColumn(",
				"          ExistWONUM = WONUM,",
				"          ExistOPERATION_ID = OPERATION_ID,",
				"          ExistSITE_ID = SITE_ID,",
				"          ExistSTATUS = STATUS,",
				"          ExistWO_STATUS_CHANGEDATE = WO_STATUS_CHANGEDATE,",
				"          ExistSNAPSHOT_DATE = SNAPSHOT_DATE",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selOpsExistingRows",
				"selectOps2, selOpsExistingRows lookup(WONUM == ExistWONUM",
				"     && SITE_ID == ExistSITE_ID,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lkpExistOperation",
				"lkpExistOperation, MaxKey join(1==1,",
				"     joinType:'cross',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joinMaxKey",
				"selOperation keyGenerate(output(NewOPERATION_ID as long),",
				"     startAt: 1L,",
				"     stepValue: 1L,",
				"     partitionBy('hash', 1)) ~> skOperation",
				"skOperation derive(OPERATION_ID = MAXKEY + NewOPERATION_ID) ~> dcOperationInsert",
				"dcOperationInsert alterRow(insertIf(1==1)) ~> alterRowOpsInsert",
				"lkpPerGrpOptn select(mapColumn(",
				"          WONUM,",
				"          PARENT,",
				"          GOVTWONUM,",
				"          LOCATION,",
				"          STATUS,",
				"          ASSETNUM,",
				"          JPNUM,",
				"          WO_STATUS_CHANGEDATE,",
				"          WORKTYPE,",
				"          TASKID,",
				"          ISTASK,",
				"          DESCRIPTION,",
				"          PLUSCJPREVNUM,",
				"          WOPRIORITY,",
				"          WO_CHANGEDATE,",
				"          STATUSDATE,",
				"          WO_STATUS_CHANGEBY,",
				"          PMDUEDATE,",
				"          TARGSTARTDATE,",
				"          TARGCOMPDATE,",
				"          REPORTDATE,",
				"          ACTLABHRS,",
				"          ACTSTART,",
				"          ACTFINISH,",
				"          ACTINTLABHRS,",
				"          ESTDUR,",
				"          WOGROUP,",
				"          PERSONGROUP,",
				"          OWNERGROUP,",
				"          PLUSCFREQUENCY,",
				"          PLUSCFREQUNIT,",
				"          PMNEXTDUEDATE,",
				"          PMNUM,",
				"          ORGANIZATION_ID,",
				"          SITE_ID,",
				"          ORGANIZATION_NM,",
				"          SITE_NM,",
				"          LOCATION_ID,",
				"          DIM_LOCATION,",
				"          LOCATION_DESC,",
				"          LOC_SITE_NM,",
				"          ASSET_ID,",
				"          ASSETNUM_ref,",
				"          SITE_ID_ref,",
				"          PERSON_ID,",
				"          PERSON_NBR,",
				"          JP_ID,",
				"          JP_NUM,",
				"          PERSON_GROUP_ID",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectOps",
				"selectOps, srcWorkOrderReadRef lookup(WONUM == RefWONUM",
				"     && SITE_ID == RefSITE_ID",
				"     && STATUS == RefSTATUS",
				"     && WO_STATUS_CHANGEDATE == RefSTATUSDATE,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     partitionBy('hash', 4,",
				"          WONUM,",
				"          SITE_ID,",
				"          STATUS,",
				"          REPORTDATE",
				"     ),",
				"     broadcast: 'both')~> lookupOpsStatusInd",
				"dcOps select(mapColumn(",
				"          WONUM,",
				"          PARENT,",
				"          GOVTWONUM,",
				"          LOCATION,",
				"          STATUS,",
				"          ASSETNUM,",
				"          JPNUM,",
				"          WO_STATUS_CHANGEDATE,",
				"          WORKTYPE,",
				"          TASKID,",
				"          ISTASK,",
				"          DESCRIPTION,",
				"          PLUSCJPREVNUM,",
				"          WOPRIORITY,",
				"          WO_CHANGEDATE,",
				"          STATUSDATE,",
				"          WO_STATUS_CHANGEBY,",
				"          PMDUEDATE,",
				"          TARGSTARTDATE,",
				"          TARGCOMPDATE,",
				"          REPORTDATE,",
				"          ACTLABHRS,",
				"          ACTSTART,",
				"          ACTFINISH,",
				"          ACTINTLABHRS,",
				"          ESTDUR,",
				"          WOGROUP,",
				"          PERSONGROUP,",
				"          OWNERGROUP,",
				"          PLUSCFREQUENCY,",
				"          PLUSCFREQUNIT,",
				"          PMNEXTDUEDATE,",
				"          PMNUM,",
				"          ORGANIZATION_ID,",
				"          SITE_ID,",
				"          ORGANIZATION_NM,",
				"          SITE_NM,",
				"          LOCATION_ID,",
				"          DIM_LOCATION,",
				"          LOCATION_DESC,",
				"          LOC_SITE_NM,",
				"          ASSET_ID,",
				"          ASSETNUM_ref,",
				"          SITE_ID_ref,",
				"          PERSON_ID,",
				"          PERSON_NBR,",
				"          JP_ID,",
				"          JP_NUM,",
				"          PERSON_GROUP_ID,",
				"          CAL_PMDUEDT,",
				"          WORKTYPE_CM_PM,",
				"          {REPORTMONTH_YEAR },",
				"          REPORTDATE_MONTH,",
				"          REPORTDATE_CM_PM,",
				"          CURRENT_RECORD_IND,",
				"          EFFECTIVE_DT,",
				"          SNAPSHOT_DATE,",
				"          AVAILABLE_MANHOUR,",
				"          PARENT_ACTLABHRS,",
				"          STATUS_FLAG",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectOps2",
				"lkpExistOperation split(!isNull(ExistOPERATION_ID),",
				"     disjoint: false) ~> splitOpsForUpdate@(UpdateCurrRecInd, DoNotReprocessNewRecords)",
				"splitOpsForUpdate@UpdateCurrRecInd select(mapColumn(",
				"          WONUM,",
				"          SITE_ID,",
				"          CURRENT_RECORD_IND,",
				"          SNAPSHOT_DATE,",
				"          ExistWONUM,",
				"          ExistOPERATION_ID,",
				"          ExistSITE_ID,",
				"          ExistSNAPSHOT_DATE",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selOpsUpdate",
				"selOpsUpdate derive(NewCURRENT_RECORD_IND = toInteger(0)) ~> dcOpsUpdate",
				"dcOpsUpdate alterRow(updateIf(CURRENT_RECORD_IND==1)) ~> alterRowUpdate",
				"lkpJobplanOptn split(isNull(JP_ID),",
				"     disjoint: false) ~> splitJobPlan@(NullJobPlanSite, NotNullJobPlanSite)",
				"selectNullJPSite, selectJPNotNullSite union(byName: true)~> unionJobplan",
				"lkpJPNullSite select(mapColumn(",
				"          WONUM,",
				"          PARENT,",
				"          GOVTWONUM,",
				"          ORGID,",
				"          SITEID,",
				"          LOCATION,",
				"          STATUS,",
				"          ASSETNUM,",
				"          JPNUM,",
				"          WO_STATUS_CHANGEDATE,",
				"          WORKTYPE,",
				"          TASKID,",
				"          ISTASK,",
				"          DESCRIPTION,",
				"          PLUSCJPREVNUM,",
				"          WOPRIORITY,",
				"          WO_CHANGEDATE,",
				"          STATUSDATE,",
				"          WO_STATUS_CHANGEBY,",
				"          PMDUEDATE,",
				"          TARGSTARTDATE,",
				"          TARGCOMPDATE,",
				"          REPORTDATE,",
				"          ACTLABHRS,",
				"          ACTSTART,",
				"          ACTFINISH,",
				"          ACTINTLABHRS,",
				"          ESTDUR,",
				"          WOGROUP,",
				"          PERSONGROUP,",
				"          OWNERGROUP,",
				"          PLUSCFREQUENCY,",
				"          PLUSCFREQUNIT,",
				"          PMNEXTDUEDATE,",
				"          PMNUM,",
				"          ORGANIZATION_ID = splitJobPlan@NullJobPlanSite@ORGANIZATION_ID,",
				"          SITE_ID = splitJobPlan@NullJobPlanSite@SITE_ID,",
				"          ORGANIZATION_NM,",
				"          SITE_NM,",
				"          LOCATION_ID,",
				"          DIM_LOCATION,",
				"          LOCATION_DESC,",
				"          LOC_SITE_NM,",
				"          ASSET_ID,",
				"          ASSETNUM_ref,",
				"          SITE_ID_ref,",
				"          PERSON_ID,",
				"          PERSON_NBR,",
				"          JP_NUM = splitJobPlan@NullJobPlanSite@JP_NUM,",
				"          JPRef_SITE_ID = splitJobPlan@NullJobPlanSite@JPRef_SITE_ID,",
				"          JPRef_ORGANIZATION_ID = splitJobPlan@NullJobPlanSite@JPRef_ORGANIZATION_ID,",
				"          JP_ID = JobplanNullSiteRd@JP_ID",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectNullJPSite",
				"splitJobPlan@NotNullJobPlanSite select(mapColumn(",
				"          WONUM,",
				"          PARENT,",
				"          GOVTWONUM,",
				"          ORGID,",
				"          SITEID,",
				"          LOCATION,",
				"          STATUS,",
				"          ASSETNUM,",
				"          JPNUM,",
				"          WO_STATUS_CHANGEDATE,",
				"          WORKTYPE,",
				"          TASKID,",
				"          ISTASK,",
				"          DESCRIPTION,",
				"          PLUSCJPREVNUM,",
				"          WOPRIORITY,",
				"          WO_CHANGEDATE,",
				"          STATUSDATE,",
				"          WO_STATUS_CHANGEBY,",
				"          PMDUEDATE,",
				"          TARGSTARTDATE,",
				"          TARGCOMPDATE,",
				"          REPORTDATE,",
				"          ACTLABHRS,",
				"          ACTSTART,",
				"          ACTFINISH,",
				"          ACTINTLABHRS,",
				"          ESTDUR,",
				"          WOGROUP,",
				"          PERSONGROUP,",
				"          OWNERGROUP,",
				"          PLUSCFREQUENCY,",
				"          PLUSCFREQUNIT,",
				"          PMNEXTDUEDATE,",
				"          PMNUM,",
				"          ORGANIZATION_ID = splitJobPlan@NotNullJobPlanSite@ORGANIZATION_ID,",
				"          SITE_ID = splitJobPlan@NotNullJobPlanSite@SITE_ID,",
				"          ORGANIZATION_NM,",
				"          SITE_NM,",
				"          LOCATION_ID,",
				"          DIM_LOCATION,",
				"          LOCATION_DESC,",
				"          LOC_SITE_NM,",
				"          ASSET_ID,",
				"          ASSETNUM_ref,",
				"          SITE_ID_ref,",
				"          PERSON_ID,",
				"          PERSON_NBR,",
				"          JP_ID,",
				"          JP_NUM,",
				"          JPRef_SITE_ID,",
				"          JPRef_ORGANIZATION_ID",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectJPNotNullSite",
				"splitJobPlan@NullJobPlanSite, JobplanNullSiteRd lookup(JPNUM == JobplanNullSiteRd@JP_NUM",
				"     && splitJobPlan@NullJobPlanSite@ORGANIZATION_ID == JobplanNullSiteRd@JPRef_ORGANIZATION_ID,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lkpJPNullSite",
				"alterRowOpsInsert sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          OPERATION_ID as integer,",
				"          WONUM as string,",
				"          PARENT as string,",
				"          GOVTWONUM as string,",
				"          ORGANIZATION_ID as integer,",
				"          SITE_ID as integer,",
				"          LOCATION_ID as integer,",
				"          ASSET_ID as integer,",
				"          PERSON_ID as integer,",
				"          JP_ID as integer,",
				"          PERSON_GROUP_ID as integer,",
				"          STATUS as string,",
				"          WORKTYPE as string,",
				"          TASKID as integer,",
				"          ISTASK as integer,",
				"          DESCRIPTION as string,",
				"          PLUSCJREVNUM as integer,",
				"          WOPRIORITY as string,",
				"          WO_CHANGEDATE as timestamp,",
				"          WO_STATUS_CHANGEDATE as timestamp,",
				"          WO_STATUS_CHANGEBY as string,",
				"          STATUSDATE as timestamp,",
				"          PMDUEDATE as timestamp,",
				"          TARGSTARTDATE as timestamp,",
				"          TARGCOMPDATE as timestamp,",
				"          REPORTDATE as timestamp,",
				"          ACTLABHRS as decimal(18,9),",
				"          ACTSTART as timestamp,",
				"          ACTFINISH as timestamp,",
				"          ACTINTLABHRS as decimal(18,9),",
				"          ESTDUR as decimal(18,9),",
				"          WOGROUP as string,",
				"          PERSON_GROUP as string,",
				"          CAL_PMDUEDT as timestamp,",
				"          WORKTYPE_CM_PM as string,",
				"          REPORTMONTH_YEAR as string,",
				"          REPORTDATE_MONTH as string,",
				"          REPORTDATE_CM_PM as timestamp,",
				"          PLUSCFREQUENCY as integer,",
				"          PLUSCFREQUNIT as string,",
				"          PMNEXTDUEDATE as date,",
				"          PMNUM as string,",
				"          AVAILABLE_MANHOUR as integer,",
				"          PARENT_ACTLABHRS as decimal(18,9),",
				"          SNAPSHOT_DATE as timestamp,",
				"          CURRENT_RECORD_IND as integer,",
				"          EFFECTIVE_DT as timestamp,",
				"          STATUS_FLAG as integer",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 2,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          OPERATION_ID,",
				"          WONUM,",
				"          PARENT,",
				"          GOVTWONUM,",
				"          ORGANIZATION_ID,",
				"          SITE_ID,",
				"          LOCATION_ID,",
				"          ASSET_ID,",
				"          PERSON_ID,",
				"          JP_ID,",
				"          PERSON_GROUP_ID,",
				"          STATUS,",
				"          WORKTYPE,",
				"          TASKID,",
				"          ISTASK,",
				"          DESCRIPTION,",
				"          PLUSCJREVNUM = PLUSCREVNUM,",
				"          WOPRIORITY,",
				"          WO_CHANGEDATE,",
				"          WO_STATUS_CHANGEDATE,",
				"          WO_STATUS_CHANGEBY,",
				"          STATUSDATE,",
				"          PMDUEDATE,",
				"          TARGSTARTDATE,",
				"          TARGCOMPDATE,",
				"          REPORTDATE,",
				"          ACTLABHRS,",
				"          ACTSTART,",
				"          ACTFINISH,",
				"          ACTINTLABHRS,",
				"          ESTDUR,",
				"          WOGROUP,",
				"          PERSON_GROUP,",
				"          CAL_PMDUEDT,",
				"          WORKTYPE_CM_PM,",
				"          REPORTMONTH_YEAR = {REPORTMONTH_YEAR },",
				"          REPORTDATE_MONTH,",
				"          REPORTDATE_CM_PM,",
				"          PLUSCFREQUENCY,",
				"          PLUSCFREQUNIT,",
				"          PMNEXTDUEDATE,",
				"          PMNUM,",
				"          AVAILABLE_MANHOUR,",
				"          PARENT_ACTLABHRS,",
				"          SNAPSHOT_DATE,",
				"          CURRENT_RECORD_IND,",
				"          EFFECTIVE_DT,",
				"          STATUS_FLAG",
				"     )) ~> sinkOpsInsert",
				"alterRowUpdate sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          OPERATION_ID as integer,",
				"          WONUM as string,",
				"          PARENT as string,",
				"          GOVTWONUM as string,",
				"          ORGANIZATION_ID as integer,",
				"          SITE_ID as integer,",
				"          LOCATION_ID as integer,",
				"          ASSET_ID as integer,",
				"          PERSON_ID as integer,",
				"          JP_ID as integer,",
				"          PERSON_GROUP_ID as integer,",
				"          STATUS as string,",
				"          WORKTYPE as string,",
				"          TASKID as integer,",
				"          ISTASK as integer,",
				"          DESCRIPTION as string,",
				"          PLUSCJREVNUM as integer,",
				"          WOPRIORITY as string,",
				"          WO_CHANGEDATE as timestamp,",
				"          WO_STATUS_CHANGEDATE as timestamp,",
				"          WO_STATUS_CHANGEBY as string,",
				"          STATUSDATE as timestamp,",
				"          PMDUEDATE as timestamp,",
				"          TARGSTARTDATE as timestamp,",
				"          TARGCOMPDATE as timestamp,",
				"          REPORTDATE as timestamp,",
				"          ACTLABHRS as decimal(18,9),",
				"          ACTSTART as timestamp,",
				"          ACTFINISH as timestamp,",
				"          ACTINTLABHRS as decimal(18,9),",
				"          ESTDUR as decimal(18,9),",
				"          WOGROUP as string,",
				"          PERSON_GROUP as string,",
				"          CAL_PMDUEDT as timestamp,",
				"          WORKTYPE_CM_PM as string,",
				"          REPORTMONTH_YEAR as string,",
				"          REPORTDATE_MONTH as string,",
				"          REPORTDATE_CM_PM as timestamp,",
				"          PLUSCFREQUENCY as integer,",
				"          PLUSCFREQUNIT as string,",
				"          PMNEXTDUEDATE as date,",
				"          PMNUM as string,",
				"          AVAILABLE_MANHOUR as integer,",
				"          PARENT_ACTLABHRS as decimal(18,9),",
				"          SNAPSHOT_DATE as timestamp,",
				"          CURRENT_RECORD_IND as integer,",
				"          EFFECTIVE_DT as timestamp,",
				"          STATUS_FLAG as integer",
				"     ),",
				"     deletable:false,",
				"     insertable:false,",
				"     updateable:true,",
				"     upsertable:false,",
				"     keys:['OPERATION_ID'],",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 1,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          OPERATION_ID = ExistOPERATION_ID,",
				"          CURRENT_RECORD_IND = NewCURRENT_RECORD_IND",
				"     )) ~> sinkOperationUpdate"
			]
		}
	}
}